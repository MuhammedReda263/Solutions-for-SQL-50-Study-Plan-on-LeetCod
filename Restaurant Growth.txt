with cte1 as(
select visited_on, sum (amount) as dialyAmount 
from Customer
group by visited_on  ),

cte2 as (select visited_on , sum (dialyAmount) over (order by visited_on rows between 6 PRECEDING and current row ) as amount
, row_number () over (order by visited_on) as rn
from cte1 )

select visited_on , amount , round((amount*1.0/7),2) as average_amount
from cte2
where rn > 6 
